FROM ansibleplaybookbundle/apb-base
# MAINTAINER {{ $MAINTAINER }}

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"aWQ6IGI0MzI1YWVhLTA0NzktNGY4ZC1iNTAyLTE5MjJiYmFlZTEzZQpuYW1lOiBtYW5hZ2VpcS1h\
cGIKaW1hZ2U6IGFuc2libGVwbGF5Ym9va2J1bmRsZS9tYW5hZ2VpcS1hcGIKZGVzY3JpcHRpb246\
ICJNYW5hZ2VJUSBpcyBhbiBvcGVuIHNvdXJjZSBtYW5hZ2VtZW50IHBsYXRmb3JtIGZvciBIeWJy\
aWQgSVQuIgpiaW5kYWJsZTogZmFsc2UKYXN5bmM6IG9wdGlvbmFsCnBhcmFtZXRlcnM6CiAgLSBu\
YW1lOiBhcHBsaWNhdGlvbl9pbml0X2RlbGF5CiAgICBkZXNjcmlwdGlvbjogVGltZSB0byBkZWxh\
eSB3ZWIgYXBwIHN0YXJ0dXAKICAgIHR5cGU6IGludAogICAgZGVmYXVsdDogNjAKICAtIG5hbWU6\
IGRhdGFiYXNlX3JlZ2lvbgogICAgZGVzY3JpcHRpb246IE1JUSBJbnN0YW5jZSBSZWdpb24KICAg\
IHR5cGU6IGludAogICAgZGVmYXVsdDogMQogIC0gbmFtZTogZGF0YWJhc2Vfc2VydmljZV9uYW1l\
CiAgICBkZXNjcmlwdGlvbjogU2VydmljZSBOYW1lIGZvciB0aGUgZGF0YWJhc2UKICAgIHR5cGU6\
IHN0cmluZwogICAgZGVmYXVsdDogbWFuYWdlaXEtcG9zdGdyZXNxbAogIC0gbmFtZTogbWVtY2Fj\
aGVkX21heF9jb25uZWN0aW9ucwogICAgZGVzY3JpcHRpb246IE1heGltdW0gbnVtYmVyIG9mIGNv\
bm5lY3Rpb25zIG1lbWNhY2hlZCB3aWxsIGFjY2VwdAogICAgdHlwZTogaW50CiAgICBkZWZhdWx0\
OiAxMDI0CiAgLSBuYW1lOiBtZW1jYWNoZWRfbWF4X21lbW9yeQogICAgZGVzY3JpcHRpb246IE1h\
eGltdW0gbWVtb3J5IG1lbWNhY2hlZCB3aWxsIHVzZSBpbiBNQgogICAgdHlwZTogaW50CiAgICBk\
ZWZhdWx0OiA2NAogIC0gbmFtZTogbWVtY2FjaGVkX3NsYWJfcGFnZV9zaXplCiAgICBkZXNjcmlw\
dGlvbjogTWVtY2FjaGVkIFNsYWIgU2l6ZSBpbiBieXRlcwogICAgdHlwZTogc3RyaW5nCiAgICBk\
ZWZhdWx0OiAxTQogIC0gbmFtZTogbWVtY2FjaGVkX3NlcnZpY2VfbmFtZQogICAgZGVzY3JpcHRp\
b246IFNlcnZpY2UgbmFtZSBvZiB0aGUgbWVtY2FjaGVkIGluc3RhbmNlIHRvIHVzZQogICAgdHlw\
ZTogc3RyaW5nCiAgICBkZWZhdWx0OiBtYW5hZ2VpcS1tZW1jYWNoZWQKICAtIG5hbWU6IG5hbWVz\
cGFjZQogICAgZGVzY3JpcHRpb246IE5hbWVzcGFjZSB0byBkZXBsb3kgdGhlIGNsdXN0ZXIgdG8K\
ICAgIHR5cGU6IHN0cmluZwogICAgZGVmYXVsdDogbWFuYWdlaXEtYXBiCiAgLSBuYW1lOiBwb3N0\
Z3Jlc3FsX2RhdGFiYXNlCiAgICBkZXNjcmlwdGlvbjogcG9zdGdyZXNxbCBkYXRhYmFzZSBuYW1l\
CiAgICB0eXBlOiBzdHJpbmcKICAgIGRlZmF1bHQ6IHZtZGJfcHJvZHVjdGlvbgogIC0gbmFtZTog\
cG9zdGdyZXNxbF9wYXNzd29yZAogICAgZGVzY3JpcHRpb246IHBvc3RncmVzcWwgZGF0YWJhc2Ug\
cGFzc3dvcmQKICAgIHR5cGU6IHN0cmluZwogICAgZGVmYXVsdDogYWRtaW4KICAtIG5hbWU6IHBv\
c3RncmVzcWxfdXNlcgogICAgZGVzY3JpcHRpb246IHBvc3RncmVzcWwgZGF0YWJhc2UgdXNlcm5h\
bWUKICAgIHR5cGU6IHN0cmluZwogICAgZGVmYXVsdDogYWRtaW4KdGFnczoKIC0gbmV0d29ya2lu\
ZwptZXRhZGF0YToKIC0gZGlzcGxheU5hbWU6ICJNYW5hZ2VJUSIKIC0gaW1hZ2VVcmw6ICJodHRw\
czovL3MzLmFtYXpvbmF3cy5jb20vZnVzb3IvMjAxN2RlbW8vTWFuYWdlSVEucG5nIiAKIC0gZG9j\
dW1lbnRhdGlvblVybDogImh0dHBzOi8vbWFuYWdlaXEub3JnL2RvY3MvIgogLSBsb25nRGVzY3Jp\
cHRpb246ICJNYW5hZ2VJUSBpcyBhbiBvcGVuIHNvdXJjZSBtYW5hZ2VtZW50IHBsYXRmb3JtIGZv\
ciBIeWJyaWQgSVQuIEl0IGNhbiBtYW5hZ2Ugc21hbGwgYW5kIGxhcmdlIGVudmlyb25tZW50cywg\
YW5kIHN1cHBvcnRzIG11bHRpcGxlIHRlY2hub2xvZ2llcyBzdWNoIGFzIHZpcnR1YWwgbWFjaGlu\
ZXMsIHB1YmxpYyBjbG91ZHMgYW5kIGNvbnRhaW5lcnMuIgo="
ADD playbooks /opt/apb/actions
ADD roles /opt/ansible/roles

RUN useradd -u 1001 -r -g 0 -M -b /opt/apb -s /sbin/nologin -c "apb user" apb
RUN chown -R 1001:0 /opt/{ansible,apb}
USER 1001
