FROM ansibleplaybookbundle/apb-src-base
# MAINTAINER {{ $MAINTAINER }}

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"aWQ6IDY0Mjk3ZTg4LTY1N2MtNDZhYi1iYjUwLTJhZjdmODRlNWVjNQpuYW1lOiBwb3N0Z3Jlc3Fs\
LWRlbW8tYXBiCmltYWdlOiBhbnNpYmxlcGxheWJvb2tidW5kbGUvcG9zdGdyZXNxbC1kZW1vLWFw\
YgpkZXNjcmlwdGlvbjogUG9zdGdyZVNRTCBhcGIgaW1wbGVtZW50YXRpb24KYmluZGFibGU6IHRy\
dWUKYXN5bmM6IG9wdGlvbmFsCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiAiUG9zdGdyZXNxbCBk\
ZW1vIgogIGxvbmdEZXNjcmlwdGlvbjogIkFuIGFwYiBkZW1vIHRoYXQgZGVwbG95cyBwb3N0Z3Jl\
c3FsIGFuZCBsb2FkcyBpdCB3aXRoIHNhbXBsZSBkYXRhIgogIGltYWdlVXJsOiAiaHR0cHM6Ly9z\
My5hbWF6b25hd3MuY29tL2Z1c29yLzIwMTdkZW1vLzY0cHgtUG9zdGdyZXNxbF9lbGVwaGFudC5z\
dmcucG5nIgogIGRvY3VtZW50YXRpb25Vcmw6ICJodHRwczovL3d3dy5wb3N0Z3Jlc3FsLm9yZy9k\
b2NzLyIKcGFyYW1ldGVyczoKICAtIG5hbWU6IG5hbWVzcGFjZQogICAgZGVzY3JpcHRpb246IE5h\
bWVzcGFjZSB0byBkZXBsb3kgdGhlIGNsdXN0ZXIgdG8KICAgIHR5cGU6IHN0cmluZwogICAgZGVm\
YXVsdDogcG9zdGdyZXNxbC1kZW1vLWFwYgogIC0gbmFtZTogcG9zdGdyZXNxbF9kYXRhYmFzZQog\
ICAgZGVzY3JpcHRpb246IHBvc3RncmVzcWwgZGF0YWJhc2UgbmFtZQogICAgdHlwZTogc3RyaW5n\
CiAgICBkZWZhdWx0OiBhZG1pbgogIC0gbmFtZTogcG9zdGdyZXNxbF9wYXNzd29yZAogICAgZGVz\
Y3JpcHRpb246IHBvc3RncmVzcWwgZGF0YWJhc2UgcGFzc3dvcmQKICAgIHR5cGU6IHN0cmluZwog\
ICAgZGVmYXVsdDogYWRtaW4KICAtIG5hbWU6IHBvc3RncmVzcWxfdXNlcgogICAgZGVzY3JpcHRp\
b246IHBvc3RncmVzcWwgZGF0YWJhc2UgdXNlcm5hbWUKICAgIHR5cGU6IHN0cmluZwogICAgZGVm\
YXVsdDogYWRtaW4K"

ADD roles /opt/ansible/roles
ADD playbooks /opt/apb/actions

RUN yum install -y postgresql && yum clean all
RUN pip install urllib3 boto

RUN useradd -u 1001 -r -g 0 -M -b /opt/apb -s /sbin/nologin -c "apb user" apb
RUN chown -R 1001:0 /opt/{ansible,apb}
USER 1001
