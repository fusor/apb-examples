#############################################################################
# Deprovision hello-world
# This role executes much of the needed functionality to deprovision an
# application using an Ansible Playbook Bundle and delete resources created
# in the sample apb generated by the provision role.
#############################################################################


#############################################################################
# Deprovision a route
#############################################################################
- openshift_v1_route:
    name: hello-world
    namespace: '{{ namespace }}'
    state: absent


#############################################################################
# Deprovision a service
#############################################################################
- k8s_v1_service:
    name: hello-world
    namespace: '{{ namespace }}'
    state: absent


#############################################################################
# Deprovision a deployment config
# Unlike other resources, deprovisioning deployment configs also requires
# cleanup of additional resources created.  This includes the pods and
# replication controller
#############################################################################
# Have to scale down first or else orphaned pods will be left.
- openshift_v1_deployment_config:
    name: hello-world
    namespace: '{{ namespace }}'
    replicas: 0
    state: present

# Delete the deployment config.
- openshift_v1_deployment_config:
    name: hello-world
    namespace: '{{ namespace }}'
    state: absent

# Destroy the orphaned replication controller.
- k8s_v1_replication_controller:
    name: hello-world-1
    namespace: '{{ namespace }}'
    state: absent
