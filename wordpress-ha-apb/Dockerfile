FROM ansibleplaybookbundle/apb-src-base
# MAINTAINER {{ $MAINTAINER }}

LABEL "com.redhat.ansibleapp.version"="0.1.0"
LABEL "com.redhat.ansibleapp.spec"=\
"aWQ6IDliNzBlNmJmLTI2ZjgtNGMxZi1hNTdmLTA3NTAxMzg4YzFlOApuYW1lOiBhbnNpYmxlcGxh\
eWJvb2tidW5kbGUvd29yZHByZXNzLWhhLWFwYgpkZXNjcmlwdGlvbjogaGlnaCBhdmFpbGFiaWxp\
dHkgd29yZHByZXNzIGRlcGxveW1lbnQKYmluZGFibGU6IHRydWUKYXN5bmM6ICJvcHRpb25hbCIK\
cGFyYW1ldGVyczoKICAtIG5hbWU6IHByb2plY3RfbmFtZQogICAgZGVzY3JpcHRpb246IE5hbWVz\
cGFjZSB0byBkZXBsb3kgY29udGFpbmVycyB0bwogICAgZGVmYXVsdDogd29yZHByZXNzLWhhCiAg\
LSBuYW1lOiByb290X3Bhc3N3b3JkCiAgICBkZXNjcmlwdGlvbjogcm9vdCBkYXRhYmFzZSBwYXNz\
d29yZAogICAgZGVmYXVsdDogazhzcGFzc3dvcmQKICAtIG5hbWU6IHh0cmFiYWNrdXBfcGFzc3dv\
cmQKICAgIGRlc2NyaXB0aW9uOiBwYXNzd29yZCBmb3Igc29tZXRoaW5nIG5vIGlkZWEgd2hhdAog\
ICAgZGVmYXVsdDogazhzcGFzc3dvcmQKICAtIG5hbWU6IGNsdXN0ZXJfbmFtZQogICAgZGVzY3Jp\
cHRpb246IG5hbWUgb2YgcGVyY29uYSBjbHVzdGVyCiAgICBkZWZhdWx0OiBwZXJjb25hCiAgLSBu\
YW1lOiBkYXRhYmFzZV9wYXNzd29yZAogICAgZGVzY3JpcHRpb246IHBhc3N3b3JkIGZvciBkYXRh\
YmFzZQogICAgZGVmYXVsdDogazhzcGFzc3dvcmQKICAtIG5hbWU6IGRhdGFiYXNlX3VzZXIKICAg\
IGRlc2NyaXB0aW9uOiB1c2VyIGZvciBkYXRhYmFzZQogICAgZGVmYXVsdDogcm9vdAogIC0gbmFt\
ZTogZGF0YWJhc2VfcmVwbGljYXMKICAgIGRlc2NyaXB0aW9uOiBudW1iZXIgb2YgZGF0YWJhc2Ug\
bm9kZXMgdG8gYnJpbmcgdXAKICAgIGRlZmF1bHQ6IDMKICAtIG5hbWU6IG1pbl93b3JkcHJlc3Nf\
cmVwbGljYXMKICAgIGRlc2NyaXB0aW9uOiBtaW5pbXVtIG51bWJlciBvZiB3b3JkcHJlc3MgcmVw\
bGljYXMgdG8gcnVuCiAgICBkZWZhdWx0OiA1CiAgLSBuYW1lOiBtYXhfd29yZHByZXNzX3JlcGxp\
Y2FzCiAgICBkZXNjcmlwdGlvbjogbWF4aW11bSBudW1iZXIgb2Ygd29yZHByZXNzIHJlcGxpY2Fz\
IHRvIHJ1bgogICAgZGVmYXVsdDogMTAK"
ADD playbooks /opt/apb/actions
ADD roles /opt/ansible/roles

RUN useradd -u 1001 -r -g 0 -M -b /opt/apb -s /sbin/nologin -c "apb user" apb
RUN chown -R 1001:0 /opt/{ansible,apb}
USER 1001
